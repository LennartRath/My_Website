---
categories:  
- ""    #the front matter should be like the one found in, e.g., blog2.md. It cannot be like the normal Rmd we used
- ""
date: "2021-10-19"
description: Case Study: AirBnB in Rio de Janeiro # the title that will show up once someone gets to this page
draft: false
image: Rio.jpg # save picture in \static\img\blogs. Acceptable formats= jpg, jpeg, or png . Your iPhone pics wont work

keywords: ""
slug: Rio # slug is the shorthand URL address... no spaces plz
title: Rio de Janeiro
---


```{r setup, include=FALSE}
# leave this chunk alone
options(knitr.table.format = "html") 
knitr::opts_chunk$set(warning = FALSE, message = FALSE, 
  comment = NA, dpi = 300)
```


# Executive Summary
Our goal is to utilize city-specific data available on airbnb to predict what a night for a 4-night booking for two people in a private room in Rio de Janeiro is likely to cost. 
For this, we created a regression model, first by handling data and understanding it, then by finding the most significant and predictive variables for our aims, building multiple models and comparing them.

The final model used to predict our stay in a [specific private room accommodation in Rioˈs Copacabana neighbourhood](https://bit.ly/3lJM4eK) predicted a price of BRL 123, and indicated a 95% certainty for the price to be within the range of BRL 41 to BRL 361, whereas the real price asked was c. BRL 250.

The model achieved to explain 43% of movements in price for the said AirBnB accomodations in Rio De Janeiro by looking at 9 different influencing variables:
- First, the number of reviews for an accommodation is considered.
- Then, the score rating from 1 to 5 for the accommodation is taken into account.
- It is then controlled for whether the accommodation is a private room, a hotel room, or a shared room.
- Further, the model considers whether a room is hosted by an AirBnB "superhost" or not.
- Additionally, it is significant to predict the price whether an accommodation is immediately bookable, or if a request to book has to be made prior.
- Also, the differentiation of whether the accommodation is available for 30 days is made.
- In addition to the review criteria above, the number of reviews an accommodation receives in a given timeframe helps to explain the price.
- The number of bedrooms further is significant in predicting the price of an accommodation.
- Lastly, the neighbourhood the accommodation is in significantly affects the price it will be offered for.


```{r load-libraries, echo=FALSE}

library(tidyverse) # the usual stuff: dplyr, readr, and other goodies
library(lubridate) # to handle dates
library(GGally) # for correlation-scatter plot matrix
library(ggfortify) # to produce residual diagnostic plots
library(rsample) # to split dataframe in training- & testing sets
library(janitor) # clean_names()
library(broom) # use broom:augment() to get tidy table with regression output, residuals, etc
library(huxtable) # to get summary table of all models produced
library(kableExtra) # for formatting tables
library(moderndive) # for getting regression tables
library(skimr) # for skim
library(mosaic)
library(leaflet) # for interactive HTML maps
library(tidytext)
library(viridis)
library(vroom)
library(car)
library(flextable)
```




We download AirBnB data from [insideairbnb.com](http://insideairbnb.com/get-the-data.html){target="_blank"}; it was originally scraped from airbnb.com. 

`vroom` will download the *.gz zipped file, unzip, and provide you with the dataframe. 


```{r load_data, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

# use cache=TRUE so you dont donwload the data everytime you knit

listings <- vroom("http://data.insideairbnb.com/brazil/rj/rio-de-janeiro/2021-09-28/data/listings.csv.gz") %>% 
       clean_names()

```

# Regression Analysis

After some experimentation, we created the following model:
```{r}
#create a new fitered dataset
filtered_listings_maxreq_4_nights <- listings_maxreq_4_nights %>%
  filter(neighbourhood_cleansed == c("Copacabana", "Jardim Botânico", "Barra da Tijuca", "Gávea", "Jacarepaguá")) %>%
#select only certain variables
  select(price_4_nights, 
         number_of_reviews,
         review_scores_rating,
         room_type,
         instant_bookable, 
         availability_30, 
         reviews_per_month, 
         bedrooms, 
         neighbourhood_cleansed) %>%
#delete the lines with NAs
  na.omit()

#creates another linear model with different variables
model6 <- lm(log(price_4_nights) ~ 
               number_of_reviews + 
               review_scores_rating + 
               room_type +
               instant_bookable +
               availability_30 +
               reviews_per_month +
               bedrooms +
               neighbourhood_cleansed,
             data = filtered_listings_maxreq_4_nights)
# print using the mosaic function
mosaic::msummary(model6)
```
Adding the neighbourhood variable increased the adj R^2 by about 5%, and 4 of the 5 neighbourhoods are statistically significant regarding both t- and p-values in explaining the variation in price. Interestingly, instant_bookable became insignificant, p- and t-values changed dramatically(!!!), meaning that it earlier seemed to be significant simply because of collinearity with truly explaining variables.


Let us have a look at the different models created:
```{r}
#creates a summary table of the various models
huxreg(model1, model2, model3, model4, model5, model6)
```
We can observe a trend of increasing R^2 and decreasing Akaike Information Criterion when adding more and more variables to the model, as is expected. Of course, the heavily filtered $model6$ uses a far lower N of observations, making us a little bit more cautious about the results. Models 5 and 6 are both massive improvements over the first models that we tried out. These first models had low explanatory power in terms of R^2 even though controlling for many variables. The later models’ improved results stem from a better choice of variables.



1. Finally, we use the best model you came up with for prediction. 

We want to book the following accommodation: https://bit.ly/3lJM4eK
This costs GBP 33.00 per night.
Let us check our model prediction:
```{r}
#Use model6 to predict, as it has highest adj. R^2
prediction <- 5.147-0.001*15-0.035*5.0-0.297*1-0.009*1+0.011*0-0.029*1.25+0.464*1-0.263*1
exp(prediction)
```
As we can see, our model predicts the price of BRL 123.439 which is equivalent to GBP 16.45 (using the exchange rate at the moment of calculation), whereas the real price is GBP 33. This is not the most precise prediction we could have obtained, but considering a relatively low R^2 of ~44%, this is still in an acceptable range, by the feeling of it.

```{r, confidence interval for prediction}
#create a dataframe for the confidence interval of model 6 
model6_prediction <- 
  data.frame(predict(model6, newdata = filtered_listings_maxreq_4_nights, interval = "prediction" )) %>%
 #create new columns to unlog the data
   mutate(price = exp(fit), 
         CI_lower = exp(lwr), 
         CI_upper = exp(upr)) %>%
  select (-fit, -lwr, -upr)

#filters the previous dataframe to only keep listings with night prices between 120 and 130 to have a better idea of the confidence interval of the prediction value that we calculated previously
model6_prediction %>%
filter(price >120 & price < 130)
```
Looking at the predicted prive of BRL 121, we can see that the 95% confidence range is between BRL 41 and BRL 361. Thus, our actual price of GBP 33 (or BRL 250) fits right within the predicted range. Of course the 95% interval range is quite large, as is to be expected from a model with a relatively weak R^2 of less than 50%, but we still can be happy (and rightfully excited) about our meaningful result!

# Findings - Next steps
Next steps would include to run code that can return the most predictive variables to a model. This could significantly aid us in finding the most meaningful variables and only include those in the model, also freeing us of any potentially only due to collinearity included variables. 
Further, one might do additional search on whether any preceding academic work on price prediction in hospitality or AirBnB specifically exists, and which variables might have been found to be most significant. Similarly, doing additional research about Rio might make sense. 
It also comes to mind that one could split Rio into clusters using coodinates, and then run a similar model that does not focus on neighbourhoods but coordinate defined geographics that can better reflect economic prosperity. Let us hope our Brazilian friend is willing to take the time to go through this with us!



# Acknowledgements

- The data for this project is from [insideairbnb.com]